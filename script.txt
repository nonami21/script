#!/bin/bash

apt-get update && apt-get install samba-dc -y
rm /etc/samba/smb.conf
samba-tool domain provision

# ???????? DNS
systemctl enable --now samba.service
# ????? ????????? ?????? DNS ?? 127.0.0.1
# (?????? ????????? ?? HQ-R)

# ??????? ????
samba-tool dns zonecreate hq-srv.hq.work br.work -U administrator
samba-tool dns zonecreate hq-srv.hq.work 100.168.192.in-addr.arpa -U administrator
samba-tool dns zonecreate hq-srv.hq.work 200.168.192.in-addr.arpa -U administrator

# ??????? ????
samba-tool dns zonelist hq-srv.hq.work -U administrator

# ????????? ????????? ?????? ???? ?
samba-tool dns add hq-srv.hq.work hq.work hq-r A 192.168.100.1 -U administrator
samba-tool dns add hq-srv.hq.work br.work br-r A 192.168.200.1 -U administrator
samba-tool dns add hq-srv.hq.work br.work br-srv A 192.168.200.2 -U administrator

# ????????? ????????? ?????? ???? PTR
samba-tool dns add hq-srv.hq.work 100.168.192.in-addr.arpa 1 PTR hq-r.hq.work -U administrator
samba-tool dns add hq-srv.hq.work 200.168.192.in-addr.arpa 1 PTR br-r.hq.work -U administrator

# ??????? ?????????? ???????? ????
samba-tool dns query hq-srv.hq.work 100.168.192.in-addr.arpa @ ALL -U administrator

# ????????? ????? ??????
host -t PTR 192.168.100.1

# ??????? ????????? ???????????? (?? ???????)
# samba-tool user create ???
# samba-tool user setexpiry ??? --noexpiry
